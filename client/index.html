<!DOCTYPE html>
<html>

<head>
    <title>Websocket Client</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="./skeleton.css">
</head>

<body>

    <div class="container">
        <h1>Hello world</h1>
        <h3 id="connected-status">Disconnected</h2>
    </div>

    <div class="container">
        <h3>Messages Received</h2>
            <table id="messages-received" class="u-full-width">
                <thead>
                    <tr>
                        <th>Message</th>
                        <th>Time</th>
                    </tr>
                </thead>
            </table>
    </div>


    <script>
        const ws = new WebSocket("ws://localhost:8765")
        const status = document.getElementById('connected-status')
        const messagesReceived = document.getElementById('messages-received')

        ws.addEventListener('open', () => {
            console.log('ws connection succeeded')

            status.innerHTML = 'Connected'
            ws.send('hello world')
        })

        ws.addEventListener('message', ({ data }) => {
            const event = JSON.parse(data)
            console.log("received:" + JSON.stringify(event))

            const row = messagesReceived.insertRow();
            const message = row.insertCell();
            const time = row.insertCell();

            // tz conversion
            let d = new Date(event.ts)

            message.innerHTML = event.message;
            time.innerHTML = d.toString();
        })

        ws.addEventListener("error", () => {
            console.log('ws connection failed')

            status.innerHTML = 'Disconnected (Error)'
        })
    </script>
</body>

</html>